<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${productDTO.id == null ? 'Add product' : 'Edit item'}"></title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container form-container">
    <h1 th:text="${productDTO.id == null ? 'Add new product' : 'Edit product'}"></h1>

    <form th:action="${productDTO.id == null ? '/products/add' : '/products/' + productDTO.id + '/edit'}"
          th:object="${productDTO}" method="post" enctype="multipart/form-data" class="form">

        <input type="hidden" th:field="*{id}" th:if="${productDTO.id != null}" />

        <div class="form-group">
            <label for="name">Title</label>
            <input type="text" id="name" th:field="*{name}" placeholder="Enter product name">
            <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="error"></p>
        </div>

        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" th:field="*{description}" placeholder="Product Description..."></textarea>
            <p th:if="${#fields.hasErrors('description')}" th:errors="*{description}" class="error"></p>
        </div>

        <div class="form-group">
            <label for="price">Price</label>
            <input type="number" id="price" th:field="*{price}" step="0.01" min="0.01" placeholder="For example: 999.99">
            <p th:if="${#fields.hasErrors('price')}" th:errors="*{price}" class="error"></p>
        </div>

        <div class="form-group">
            <label for="stockQuantity">Quantity in stock</label>
            <input type="number" id="stockQuantity" th:field="*{stockQuantity}" min="0" placeholder="Enter the quantity">
            <p th:if="${#fields.hasErrors('stockQuantity')}" th:errors="*{stockQuantity}" class="error"></p>
        </div>

        <div class="form-group">
            <label for="imageFile">Image</label>
            <div class="custom-file-input-wrapper">
                <label for="imageFile" class="custom-file-label">Select an image</label>
                <input type="file" id="imageFile" name="imageFile" accept="image/*" onchange="updateFileName(this)">
                <span id="selected-file-name" class="file-name">File not selected</span>
            </div>
            <p th:if="${#fields.hasErrors('imageFile')}" th:errors="*{imageFile}" class="error"></p>

            <div th:if="${productDTO.imageUrl}" class="current-image">
                <p>Current image:</p>
                <img th:src="${productDTO.imageUrl}" alt="Current product image">
                <p><a href="#" onclick="document.getElementById('imageUrlHidden').value=''; return false;">Clear the current image</a></p>
                <input type="hidden" id="imageUrlHidden" th:field="*{imageUrl}">
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="button" th:text="${productDTO.id == null ? 'Add product' : 'Save changes'}"></button>
            <a th:href="@{/products}" class="button outline back-button">Cancel</a>
        </div>
    </form>
</div>

<script>
    function updateFileName(input)
    {
        const fileNameSpan = document.getElementById("selected-file-name");
        if (input.files && input.files.length > 0)
        {
            fileNameSpan.textContent = input.files[0].name;
        }
        else
        {
            fileNameSpan.textContent = "Файл не выбран";
        }
    }
</script>
</body>
</html>
